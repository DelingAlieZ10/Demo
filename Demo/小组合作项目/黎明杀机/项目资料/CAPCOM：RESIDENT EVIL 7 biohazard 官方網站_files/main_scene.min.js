var MainScene=function(a){this.setupMember(a);this.frame=0;this._lights=[];this.lightPosition=[new THREE.Vector3(3,-10,-20),new THREE.Vector3(0,-10,-20),new THREE.Vector3(3,-10,-20)];this.lightIntensity=[1.5,5,1.5];this.lightRoundAngle=[parseInt(360*Math.random()),parseInt(360*Math.random()),parseInt(360*Math.random())];this.lightMode=-1;this.tableObj=this.doorLight=this.roomLight=null;this.vignetteEnable=!0;this.vignetteAngle=120;this.vignetteAnglePlus=.01;this.vignetteRadius=1;this.vignetteAmountReset=
    3;this.visibilityDarkness=!0;this.randomVignette=!1;this.randomVignetteAngle=0;this.randomVignetteRadius=2;this.randomVignetteAnglePlus=1;this.randomVignetteBaseValue=.6;this.destCameraY=this.destCameraX=0;this.fireParticles=[]};MainScene.LightMode={};MainScene.LightMode.Blink=0;MainScene.LightMode.Round=1;MainScene.prototype=new Scene;MainScene.prototype.initialize=function(){$("#canvasArea").css("background","none")};
MainScene.prototype.setupEvents=function(){$(window).on("resize",this.onWindowResizeHandler.bind(this));$("#mainTop").on("mousemove",this.onDocumentMouseMove.bind(this));$(window).trigger("resize")};
MainScene.prototype.onWindowResizeHandler=function(a){var b=this;clearTimeout(b._resizeId);b._resizeId=setTimeout(function(){b._windowWidth=$("#canvasArea").width();b._windowHeight=.5625*b._windowWidth;b._renderEngine._renderer.setSize(b._windowWidth,b._windowHeight);b._renderEngine._camera.aspect=b._windowWidth/b._windowHeight;b._renderEngine._camera.updateProjectionMatrix();b._renderEngine.render();$("#mainVisual").css("height",b._windowHeight-70);$("#mainTop").css("height",b._windowHeight-150)},
    10)};MainScene.prototype.onDocumentMouseMove=function(a){a.preventDefault();var b=a.clientY-window.innerHeight/2;this._mouseXpercent=(a.clientX-window.innerWidth/2)/(window.innerWidth/2);this._mouseYpercent=b/(window.innerHeight/2);this.destCameraX=8*this._mouseXpercent*(1280/$(window).width());this.destCameraY=-2+-.4*this._mouseYpercent};
MainScene.prototype.setupPostProcess=function(){RenderEngine.Shader.MultiPassBloom.params.blurAmount=.6;RenderEngine.ShaderEnable.Vignette=!0;RenderEngine.ShaderEnable.BoxBlur=!0;RenderEngine.Shader.Vignette.params.falloff=.1};
MainScene.prototype.setupLights=function(){for(var a=0;a<this.lightPosition.length;a++){var b=new THREE.PointLight(8947848);b.position.x=this.lightPosition[a].x;b.position.y=this.lightPosition[a].y;b.position.z=this.lightPosition[a].z;b.intensity=this.lightIntensity[a];this._lights.push(b);this._scene.add(b)}this.roomLight=new THREE.PointLight(16777215);this.roomLight.intensity=2;this.roomLight.position.z=-20;this.roomLight.position.x=7;this.roomLight.decay=10;this.doorLight=new THREE.PointLight(16777215);
    this.doorLight.intensity=2;this.doorLight.position.x=-10;this.doorLight.position.y=10;this.doorLight.position.z=-10;this.doorLight.decay=10;a=new THREE.AmbientLight(16777215,5);this._scene.add(a);this._renderEngine._rootScene.fog=new THREE.FogExp2(0,.07)};MainScene.prototype.setupObjects=function(){var a=loadTexture("../assets/images/index/dinner.jpg"),a=new THREE.MeshPhongMaterial({map:a}),b=new THREE.PlaneGeometry(70,35,4,4),a=new THREE.Mesh(b,a);a.position.y=-0;a.position.z=-23;this._scene.add(a)};
MainScene.prototype.blink=function(){0==this.randomVignette&&(this.randomVignetteRadius=.1+.02*Math.random(),this.randomVignetteAnglePlus=.2+.7*Math.random(),this.randomVignette=!0);setTimeout(this.blink.bind(this),1E4+2E3*(Math.random()-.5))};
MainScene.prototype.update=function(){if(this.lightMode==MainScene.LightMode.Blink){if(0==this.frame%5)for(var a=0;a<this.lightIntensity.length;a++)if(.5<=Math.random()){this._lights[a].intensity+=1.5*Math.random();break}for(a=0;a<this.lightIntensity.length;a++)this._lights[a].intensity+=.05*(this.lightIntensity[a]-this._lights[a].intensity)}this.vignetteEnable&&(a=this.vignetteAmountReset+this.vignetteRadius*Math.sin(this.vignetteAngle*Math.PI/180),RenderEngine.Shader.Vignette.params.amount=this.randomVignetteBaseValue+
    a,this.vignetteAngle+=1,this.vignetteRadius+=this.vignetteAnglePlus,this.vignetteAnglePlus+=.001,5<this.vignetteRadius&&(this.vignetteRadius=5),RenderEngine.Shader.BoxBlur.params.delta.x=a+2,RenderEngine.Shader.BoxBlur.params.delta.y=a+2,this.visibilityDarkness&&2>RenderEngine.Shader.Vignette.params.amount&&($(scene._renderEngine._rootScene.fog).animate({density:.05},1500),this.visibilityDarkness=!1),.65>RenderEngine.Shader.Vignette.params.amount&&(this.vignetteEnable=!1,RenderEngine.Shader.Vignette.params.falloff=
    .6,$(RenderEngine.Shader.BoxBlur.params.delta).animate({x:0,y:0},1100)));this.randomVignette&&(a=this.randomVignetteRadius*Math.sin(this.randomVignetteAngle*Math.PI/180),RenderEngine.Shader.Vignette.params.amount=a+this.randomVignetteBaseValue,this.randomVignetteAngle+=this.randomVignetteAnglePlus,scene._renderEngine._rootScene.fog.density=.05+.003*a,180<this.randomVignetteAngle&&(this.randomVignetteAngle=0,this.randomVignette=!1));this._renderEngine._camera.position.x+=.03*(this.destCameraX-this._renderEngine._camera.position.x);
    this._renderEngine._camera.position.y+=.03*(this.destCameraY-this._renderEngine._camera.position.y);for(a=0;a<this.fireParticles.length;a++)this.fireParticles[a].update();this.frame+=1};var FireParticle=function(a){this._scene=a;this._particleCount=80;this._particles=[];this._texture=loadTexture("../assets/images/index/fire_particle.png");this._material=null;this._scale=10;this._basePosition=new THREE.Vector3};
FireParticle.prototype.initialize=function(){this._material=new THREE.SpriteMaterial({map:this._texture,transparent:!0,opacity:.5,alphaTest:.2,blending:THREE.AdditiveBlending,color:16707229,fog:!0})};
FireParticle.prototype.createParticles=function(a,b,d){this._basePosition.x=a;this._basePosition.y=b;this._basePosition.z=d;for(var e=0;e<this._particleCount;e++){var c=new THREE.Sprite(this._material);c.position.x=a;c.position.y=b;c.position.z=d;c.scale.multiplyScalar(.08*this._scale*Math.random());c.velocity=new THREE.Vector3(0,.1*this._scale*Math.random(),0);this._particles.push(c);this._scene.add(c)}};
FireParticle.prototype.update=function(){for(var a=0;a<this._particleCount;a++){var b=this._particles[a];b.position.y>this._basePosition.y+.1&&(b.position.y=this._basePosition.y,b.velocity.y=.1*this._scale*Math.random(),b.scale.x=b.scale.y=1,b.scale.multiplyScalar(.08*this._scale*Math.random()));b.scale.multiplyScalar(.98);b.velocity.y+=5E-4*this._scale;b.position.y+=b.velocity.y}};
